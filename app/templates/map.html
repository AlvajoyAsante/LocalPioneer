<style>
    .center {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #F6F6DB;
    }

    #map-page {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 80%;
        max-width: 1000px;
    }

    #map {
        height: 400px;
        width: 100%;
        background-color: #e5e5e5;
        /* Placeholder color */
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .search-box {
        padding: 20px;
        background-color: white;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .search-title {
        font-size: 1.2rem;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .checkbox-group {
        display: flex;
        gap: 20px;
        margin-bottom: 20px;
    }

    .checkbox-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .address-section {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .address-input-group {
        display: flex;
        gap: 10px;
    }

    .address-bar {
        flex-grow: 1;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    .btn {
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
    }

    .btn-primary {
        background-color: #007bff;
        color: white;
    }

    .btn-secondary {
        background-color: #6c757d;
        color: white;
    }

    .saved-addresses {
        width: 200px;
        padding: 8px;
        border: 1px solid #ccc;
        border-radius: 4px;
    }

    #map-buttons {
        display: flex;
        justify-content: flex-start;
        margin-top: 10px;
    }
</style>


<div class="center">
    <div id="map-page">
        <!-- Map Container -->
        <div id="map"></div>

        <!-- Search Box -->
        <div class="search-box">
            <div class="search-title">What are you looking for?</div>

            <!-- Checkboxes -->
            <div class="checkbox-group">
                <label class="checkbox-item">
                    <input type="checkbox" id="volunteering-checkbox" value="volunteering" checked>
                    Volunteering
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="workshop-checkbox" value="workshop" checked>
                    Workshop
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="fundraiser-checkbox" value="fundraiser" checked>
                    Fundraiser
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="social-checkbox" value="social" checked>
                    Social
                </label>
                <label class="checkbox-item">
                    <input type="checkbox" id="other-checkbox" value="other" checked>
                    Other
                </label>
            </div>
            <div class="radius-control">
                <select id="radius-select" class="form-select">
                    <!-- Options will be added dynamically -->
                </select>
            </div>

            <!-- Address Section -->
            <div class="address-section">
                <div class="address-input-group">
                    <input type="text" id="address-bar" class="address-bar" placeholder="Enter address...">
                </div>

                
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Initialize map centered on United States
        const map = L.map('map').setView([39.8283, -98.5795], 4); // Center of US
        const eventTypes = ['volunteering', 'workshop', 'fundraiser', 'social', 'other'];
        let userMarker = null;
        let radiusCircle = null;
        const activeMarkers = [];

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        // Update radius select options (roughly equivalent to 10, 25, and 50 miles)
        const radiusSelect = document.getElementById('radius-select');
        radiusSelect.innerHTML = `
          <option value="16">Within 16 km (~10 miles)</option>
          <option value="40">Within 40 km (~25 miles)</option>
          <option value="80">Within 80 km (~50 miles)</option>
          <option value="161">Within 161 km (~100 miles)</option>
      `;

        // Function to geocode address
        async function geocodeAddress(address) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&countrycodes=us`);
                const data = await response.json();

                if (data.length > 0) {
                    const { lat, lon } = data[0];
                    return { lat: parseFloat(lat), lng: parseFloat(lon) };
                }
                throw new Error('Address not found');
            } catch (error) {
                console.error('Geocoding error:', error);
                return null;
            }
        }

        // Function to handle address search
        async function handleAddressSearch() {
            const addressInput = document.getElementById('address-bar');
            const address = addressInput.value.trim();

            if (address) {
                const coords = await geocodeAddress(address);
                if (coords) {
                    const radiusInKm = parseFloat(radiusSelect.value);

                    // Update map view and fetch events
                    map.setView([coords.lat, coords.lng], 12);
                    updateEventMarkers(coords.lat, coords.lng, radiusInKm);
                } else {
                    alert('Address not found. Please try again.');
                }
            }
        }

        // Add event listener to address bar for Enter key
        document.getElementById('address-bar').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                handleAddressSearch();
            }
        });

        // Modify updateEventMarkers function
        async function updateEventMarkers(userLat, userLng, radiusKm) {
            // Clear existing markers
            activeMarkers.forEach(marker => map.removeLayer(marker));
            activeMarkers.length = 0;

            if (userMarker) map.removeLayer(userMarker);
            if (radiusCircle) map.removeLayer(radiusCircle);

            // Add user marker
            userMarker = L.marker([userLat, userLng], {
                icon: L.divIcon({
                    className: 'user-location',
                    html: '📍',
                    iconSize: [25, 25]
                })
            }).addTo(map);

            // Add radius circle
            radiusCircle = L.circle([userLat, userLng], {
                radius: radiusKm * 1000,
                fillColor: '#007bff',
                fillOpacity: 0.1,
                color: '#007bff',
                opacity: 0.3
            }).addTo(map);

            // Fit the map to show the entire circle with padding
            map.fitBounds(radiusCircle.getBounds(), {
                padding: [50, 50],
                maxZoom: 20 // Prevent zooming in too close
            });

            try {
                // ... rest of your event fetching code ...
            } catch (error) {
                console.error('Error fetching events:', error);
            }
        }

        // Add a search button
        const addressInputGroup = document.querySelector('.address-input-group');
        const searchButton = document.createElement('button');
        searchButton.className = 'btn btn-primary';
        searchButton.textContent = 'Search';
        searchButton.onclick = handleAddressSearch;
        addressInputGroup.appendChild(searchButton);

        // Initialize event listeners
        eventTypes.forEach(type => {
            document.getElementById(`${type}-checkbox`).addEventListener('change', () => {
                const address = document.getElementById('address-bar').value.trim();
                if (address) {
                    handleAddressSearch();
                }
            });
        });

        radiusSelect.addEventListener('change', () => {
            const address = document.getElementById('address-bar').value.trim();
            if (address) {
                handleAddressSearch();
            }
        });
    });
</script>